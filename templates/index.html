{% extends 'base.html' %}

{% block title %}Cricbuzz Live Score - Live Cricket Score, Today Match Score, Ball by Ball{% endblock %}

{% block meta_description %}Get live cricket scores, today match live score, ball by ball commentary, IPL 2026 live, IND vs AUS live score, T20 World Cup, dream11 prediction, pitch report on Cricbuzz Live Score.{% endblock %}

{% block meta_keywords %}live cricket score, today match live score, cricket live score, live score, ind vs aus, ind vs eng, ipl 2026 live score, t20 world cup live, cricket scorecard, ball by ball commentary, dream11 prediction, pitch report, playing 11, cricket match today{% endblock %}

{% block og_title %}Cricbuzz Live Score - Live Cricket Score, Today Match{% endblock %}
{% block og_description %}Get live cricket scores, today match live score, ball by ball commentary on Cricbuzz Live Score.{% endblock %}

{% block schema %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "SportsOrganization",
    "name": "Cricbuzz Live Score",
    "url": "https://cricbuzz-live-score.com",
    "sport": "Cricket",
    "description": "Live cricket scores, ball by ball commentary, match updates, schedules, fixtures, points table and results."
}
</script>
{% endblock %}

{% block content %}
<section class="matches-section">
    {% if matches %}
    <div class="match-category">
        <div class="slider-wrapper">
            <div class="matches-slider">
                <div class="slider-track">
                {% for match in matches %}
                <div class="match-card" data-match-id="{{ match.match_id }}" onclick="loadScorecard('{{ match.match_id }}')">
                    <div class="card-header">
                        <span class="series-name">{{ match.match_format or 'Match' }}</span>
                        <span class="status-badge {% if match.state in ['Live', 'In Progress'] %}live{% elif match.state in ['Stumps', 'Lunch', 'Tea', 'Drinks'] %}break{% elif match.state == 'Innings Break' %}innings{% elif match.state in ['Complete', 'Completed'] %}complete{% elif match.state == 'Preview' %}preview{% elif match.state == 'Abandon' %}abandon{% else %}upcoming{% endif %}">
                            {{ match.state|upper if match.state else 'UPCOMING' }}
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="teams-container">
                            <div class="team-row">
                                {% if match_flags.get(match.match_id ~ '_1') %}
                                <img src="{{ match_flags.get(match.match_id ~ '_1') }}" alt="" class="team-flag">
                                {% else %}
                                <span class="team-flag-placeholder"></span>
                                {% endif %}
                                <span class="team-name">{{ match.team1_name or 'Team 1' }}</span>
                                <span class="team-score">{{ normalize_score(match.team1_score) or '' }}</span>
                            </div>
                            <div class="team-row">
                                {% if match_flags.get(match.match_id ~ '_2') %}
                                <img src="{{ match_flags.get(match.match_id ~ '_2') }}" alt="" class="team-flag">
                                {% else %}
                                <span class="team-flag-placeholder"></span>
                                {% endif %}
                                <span class="team-name">{{ match.team2_name or 'Team 2' }}</span>
                                <span class="team-score">{{ normalize_score(match.team2_score) or '' }}</span>
                            </div>
                        </div>
                        {% if match.result %}
                        <div class="match-result {% if 'session' in match.result.lower() or 'lunch' in match.result.lower() or 'tea' in match.result.lower() or 'stumps' in match.result.lower() or 'break' in match.result.lower() %}result-session{% elif 'opt to' in match.result.lower() or 'delayed' in match.result.lower() %}result-toss{% elif 'won' in match.result.lower() or 'win' in match.result.lower() %}result-won{% elif 'need' in match.result.lower() %}result-need{% elif 'match starts' in match.result.lower() or 'start' in match.result.lower() %}result-upcoming{% endif %}">{{ match.result }}</div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    {% if not matches %}
    <div class="no-matches">
        <p>No matches available</p>
        <p class="hint">Scrape live scores from Admin Panel</p>
    </div>
    {% endif %}
</section>

<section class="main-container">
    <div class="content-wrapper">
        <!-- Recent News / Scorecard - Separate Box -->
        <div class="news-box" id="content-box">
            <div id="news-content">
            <h3>Recent News</h3>
            {% if recent_posts %}
            <div class="news-grid">
                {% for post in recent_posts %}
                <a href="/post/{{ post.slug }}" class="news-card">
                    {% if post.thumbnail %}
                    <img src="{{ post.thumbnail }}" alt="{{ post.title }}" class="news-thumb">
                    {% else %}
                    <div class="news-thumb no-thumb"></div>
                    {% endif %}
                    <div class="news-info">
                        <h4>{{ post.title }}</h4>
                        <span class="news-date">{{ post.created_at.strftime('%b %d, %Y') }}</span>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <p class="placeholder-text">No news available yet</p>
            {% endif %}
            </div>
            <div id="scorecard-content" style="display: none;"></div>
        </div>
        
        <!-- Top Stories + Quick Links - Together -->
        <div class="sidebar-box">
            <div class="section-block">
                <h4>Top Stories</h4>
                <div class="top-stories-list">
                    {% if recent_posts %}
                    {% for post in recent_posts[:3] %}
                    <a href="/post/{{ post.slug }}" class="top-story-item">
                        <div class="top-story-thumb">
                            {% if post.thumbnail %}
                            <img src="{{ post.thumbnail }}" alt="{{ post.title }}" onerror="this.src='/static/images/default-thumb.png'">
                            {% else %}
                            <div class="thumb-placeholder"><i class="fas fa-cricket-bat-ball"></i></div>
                            {% endif %}
                        </div>
                        <div class="top-story-title">{{ post.title[:45] }}{% if post.title|length > 45 %}...{% endif %}</div>
                    </a>
                    {% endfor %}
                    {% else %}
                    <div class="top-story-item">
                        <div class="top-story-thumb"><div class="thumb-placeholder"><i class="fas fa-newspaper"></i></div></div>
                        <div class="top-story-title">Latest cricket updates</div>
                    </div>
                    <div class="top-story-item">
                        <div class="top-story-thumb"><div class="thumb-placeholder"><i class="fas fa-trophy"></i></div></div>
                        <div class="top-story-title">Player rankings</div>
                    </div>
                    <div class="top-story-item">
                        <div class="top-story-thumb"><div class="thumb-placeholder"><i class="fas fa-list"></i></div></div>
                        <div class="top-story-title">Team standings</div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="section-block">
                <h4>Quick Links</h4>
                <ul class="sidebar-list">
                    <li><a href="/teams">All Teams</a></li>
                    <li><a href="/series">Series</a></li>
                    <li><a href="/live-scores">Live Scores</a></li>
                </ul>
            </div>
        </div>
    </div>
</section>


<style>
:root {
    --header-height: 45px !important;
}

@media (max-width: 576px) {
    :root {
        --header-height: 79px !important;
    }
}

/* Series Section Styles */
.series-section {
    background: #fff;
    padding: 15px 0;
    margin: 0 20px 15px 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.series-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.series-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.series-header h3 {
    color: #1a472a;
    font-size: 16px;
    font-weight: 700;
    margin: 0;
}

.view-all-btn {
    color: #1a472a;
    font-size: 12px;
    text-decoration: none;
    font-weight: 600;
    padding: 5px 12px;
    border: 1px solid #1a472a;
    border-radius: 15px;
    transition: all 0.2s;
}

.view-all-btn:hover {
    background: #1a472a;
    color: #fff;
}

.series-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 12px;
}

.series-card {
    background: linear-gradient(135deg, #1a472a, #2d6a4f);
    padding: 12px 15px;
    border-radius: 8px;
    text-decoration: none;
    transition: transform 0.2s, box-shadow 0.2s;
}

.series-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(26, 71, 42, 0.3);
}

.series-card .series-name {
    color: #fff;
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 5px;
    line-height: 1.3;
}

.series-card .series-date {
    color: rgba(255,255,255,0.7);
    font-size: 11px;
}

@media (max-width: 576px) {
    .series-section {
        margin: 0 10px 10px 10px;
        padding: 12px 0;
    }
    
    .series-grid {
        grid-template-columns: 1fr;
    }
}

.matches-section {
    padding: 35px 0 10px 0;
    margin-bottom: 0;
    margin-top: 0;
    overflow: visible;
}

.match-category {
    margin-bottom: 1px;
    overflow: visible;
}

.category-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    padding: 0 5px;
}

.category-header h3 {
    font-size: 1rem;
    color: #333;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
}

.status-dot.live { background: #ff4444; animation: pulse 1.5s infinite; }
.status-dot.innings { background: #ffaa00; }
.status-dot.complete { background: #00cc66; }
.status-dot.upcoming { background: #3498db; }

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.match-count {
    background: #e0e0e0;
    padding: 2px 10px;
    border-radius: 12px;
    font-size: 0.8rem;
    color: #555;
}

.slider-wrapper {
    overflow: visible;
    margin: 0 -15px;
    padding: 0 15px;
}

.matches-slider {
    overflow-x: auto;
    overflow-y: visible;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding-bottom: 15px;
    margin-bottom: -15px;
    cursor: grab;
}

.matches-slider::-webkit-scrollbar {
    display: none;
    width: 0;
    height: 0;
}

.matches-slider * {
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.matches-slider:active {
    cursor: grabbing;
}

.slider-track {
    display: flex;
    gap: 10px;
    padding: 15px 5px 5px 5px;
    width: max-content;
}

.match-card {
    min-width: 280px;
    max-width: 280px;
    background: #fff;
    border-radius: 8px;
    overflow: visible;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    flex-shrink: 0;
}

.match-card > .card-header {
    background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 100%);
    padding: 8px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.series-name {
    color: #fff;
    font-size: 0.75rem;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
}

.status-badge {
    font-size: 0.65rem;
    font-weight: 700;
    color: #fff;
    background: #ff4444;
    padding: 3px 8px;
    border-radius: 3px;
    text-transform: uppercase;
}

.status-badge.live { background: #ff4444; }
.status-badge.innings { background: #ffaa00; color: #333; }
.status-badge.break { background: #ff8800; color: #fff; }
.status-badge.complete { background: #00cc66; }
.status-badge.preview { background: #9b59b6; }
.status-badge.abandon { background: #666; }
.status-badge.upcoming { background: #3498db; }

.card-body {
    padding: 4px 10px 6px 10px;
}

.match-format-row {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 6px;
}

.format-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #ccc;
}

.format-dot.live {
    background: #ff4444;
    animation: pulse 1.5s infinite;
}

.format-dot.innings {
    background: #ffaa00;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
}

.format-text {
    font-size: 0.75rem;
    color: #666;
    font-weight: 500;
}

.teams-container {
    display: flex;
    flex-direction: column;
    gap: 0;
    margin-bottom: 0;
}

.team-row {
    display: flex;
    flex-direction: row;
    gap: 8px;
    width: 100%;
    padding: 3px 0;
}

.team-row:first-child {
    border-bottom: 1px solid #eee;
    padding-bottom: 4px;
}

.team-row:last-of-type {
    border-bottom: 1px solid #eee;
    padding-bottom: 4px;
}

.team-flag {
    width: 28px;
    height: 20px;
    object-fit: cover;
    border-radius: 3px;
    border: 1px solid #ddd;
    flex-shrink: 0;
    display: block;
    vertical-align: middle;
}

.team-flag-placeholder {
    width: 28px;
    height: 20px;
    background: linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%);
    border-radius: 3px;
    flex-shrink: 0;
    display: block;
    vertical-align: middle;
}

.team-name {
    font-weight: 600;
    color: #333;
    font-size: 0.9rem;
    flex: 1;
    line-height: 20px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: left;
}

.team-score {
    font-weight: 700;
    color: #222;
    font-size: 0.9rem;
    flex-shrink: 0;
    text-align: right;
}

.match-result {
    font-size: 0.7rem;
    color: #00aa55;
    font-weight: 500;
    padding-top: 3px;
    margin-top: 2px;
    margin-bottom: 0;
    line-height: 1.2;
}

.match-result.result-won {
    color: #2196F3;
}

.match-result.result-need {
    color: #e53935;
}

.match-result.result-upcoming {
    color: #FF9800;
}

.match-result.result-session {
    color: #e53935;
    font-weight: 600;
}

.match-result.result-toss {
    color: #FF9800;
    font-weight: 600;
}

.match-date {
    font-size: 0.7rem;
    color: #666;
}

.no-matches {
    text-align: center;
    padding: 40px;
    background: #f5f5f5;
    border-radius: 10px;
    color: #666;
}

.no-matches .hint {
    font-size: 0.85rem;
    color: #999;
    margin-top: 10px;
}

@media (max-width: 768px) {
    .matches-section {
        padding: 10px 0;
        overflow: visible;
    }
    
    .match-category {
        overflow: visible;
        padding: 0 8px;
    }
    
    .matches-slider {
        scrollbar-width: none;
        -ms-overflow-style: none;
        -webkit-overflow-scrolling: touch;
        overflow-x: scroll;
        overflow-y: visible;
    }
    
    .matches-slider::-webkit-scrollbar {
        display: none;
        width: 0px;
        height: 0px;
        background: transparent;
    }
    
    .slider-track {
        padding: 5px 0;
    }
    
    .match-card {
        min-width: 260px;
        max-width: 260px;
    }
    
    .card-header {
        padding: 6px 10px;
    }
    
    .card-body {
        padding: 6px 10px;
    }
    
    .series-name {
        font-size: 0.7rem;
        max-width: 150px;
    }
    
    .team-name {
        font-size: 0.8rem;
    }
    
    .team-row {
        padding: 5px 0 0 0;
    }
    
    .match-format-row {
        margin-bottom: 4px;
    }
    
    .team-flag {
        width: 24px;
        height: 16px;
    }
    
    .team-flag-placeholder {
        width: 24px;
        height: 16px;
    }
    
    .content-wrapper {
        flex-direction: column;
    }
    
    
    .sidebar {
        width: 100%;
    }
    
    .news-box {
        width: 100%;
    }
    
    .sidebar-box {
        width: 100%;
        max-width: 100%;
    }
}

.main-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 0 20px 0;
    margin-top: 5px;
}

.unified-content-box {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 10px 15px 15px 15px;
    margin-top: 0;
}

.unified-content-box .content-wrapper {
    margin-top: 0;
    padding-top: 0;
}

.section-block {
    margin-bottom: 10px;
    margin-top: 0;
    padding-top: 0;
}

.section-block:last-child {
    margin-bottom: 0;
}

.section-block:first-child {
    margin-top: 0;
}

.section-block h3,
.section-block h4 {
    margin: 0 0 8px 0;
    color: #1a472a;
    font-size: 1rem;
    border-bottom: 2px solid #1a472a;
    padding-bottom: 5px;
}

.content-wrapper {
    display: flex;
    gap: 20px;
    align-items: flex-start;
    margin-top: 0;
}

.news-box {
    flex: 2;
    min-width: 0;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 20px;
}

.news-box h3 {
    margin: 0 0 15px 0;
    color: #1a472a;
    font-size: 1.1rem;
    border-bottom: 2px solid #1a472a;
    padding-bottom: 10px;
}

.sidebar-box {
    flex: 1;
    min-width: 250px;
    max-width: 300px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 20px;
}

@media (max-width: 768px) {
    .sidebar-box {
        width: 100% !important;
        max-width: 100% !important;
        min-width: 100% !important;
    }
}


.content-card {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 20px;
    margin-bottom: 1px;
}

.content-card h3 {
    margin: 0 0 15px 0;
    color: #1a472a;
    font-size: 1.1rem;
    border-bottom: 2px solid #1a472a;
    padding-bottom: 10px;
}

.placeholder-text {
    color: #888;
    font-size: 0.9rem;
}

.news-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 16px;
}

.news-card {
    display: flex;
    flex-direction: column;
    text-decoration: none;
    border-radius: 8px;
    overflow: hidden;
    background: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    transition: transform 0.2s, box-shadow 0.2s;
}

.news-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.news-thumb {
    width: 100%;
    height: auto;
    aspect-ratio: 16/9;
    object-fit: cover;
}

.news-thumb.no-thumb {
    background: linear-gradient(135deg, #1a472a 0%, #2d6a4f 100%);
}

.news-info {
    padding: 12px;
}

.news-info h4 {
    margin: 0 0 8px 0;
    font-size: 0.9rem;
    color: #222;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.news-date {
    font-size: 0.75rem;
    color: #888;
}

.sidebar {
    width: 300px;
    flex-shrink: 0;
}

.sidebar-card {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 15px;
    margin-bottom: 1px;
}

.sidebar-card h4 {
    margin: 0 0 12px 0;
    color: #1a472a;
    font-size: 1rem;
    border-bottom: 1px solid #eee;
    padding-bottom: 8px;
}

.sidebar-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.sidebar-list li {
    padding: 8px 0;
    border-bottom: 1px solid #f0f0f0;
    font-size: 0.9rem;
    color: #555;
}

.sidebar-list li:last-child {
    border-bottom: none;
}

.sidebar-list a {
    color: #1a472a;
    text-decoration: none;
}

.sidebar-list a:hover {
    text-decoration: underline;
}

.match-card {
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}

.match-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.2);
}

.match-card.active {
    border: 2px solid #1a472a;
}

/* Scorecard Styles */
.scorecard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #1a472a;
    gap: 10px;
    flex-wrap: wrap;
}

.scorecard-header h3 {
    margin: 0;
    color: #1a472a;
    font-size: 1.1rem;
    border: none;
    padding: 0;
}

.scorecard-header .status-badge {
    margin-left: 10px;
}

.match-scores-summary {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    font-size: 0.95rem;
    color: #333;
    font-weight: 600;
    margin-top: 5px;
}

.match-scores-summary span {
    background: #f0f0f0;
    padding: 4px 10px;
    border-radius: 4px;
}

.back-to-news {
    background: #1a472a;
    color: #fff;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
}

.back-to-news:hover {
    background: #2d5a3d;
}

.scorecard-match-info {
    background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 100%);
    color: #fff;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
}

.scorecard-match-info .match-title {
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.scorecard-match-info .match-venue {
    font-size: 0.85rem;
    opacity: 0.9;
}

.scorecard-match-info .match-result-text {
    margin-top: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    color: #90EE90;
}

.scorecard-match-info .match-format {
    font-size: 0.85rem;
    color: #aaa;
    margin-top: 4px;
}

.scorecard-match-info .match-datetime {
    font-size: 0.85rem;
    color: #888;
    margin-top: 4px;
}

.scorecard-match-info .match-toss {
    font-size: 0.85rem;
    color: #4CAF50;
    margin-top: 8px;
    font-style: italic;
}

.scorecard-match-info .match-live-status {
    font-size: 0.95rem;
    color: #FF5722;
    margin-top: 8px;
    font-weight: 600;
}

.fow-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
    font-size: 0.85rem;
}

.fow-table th {
    background: #f5f5f5;
    padding: 8px;
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid #ddd;
}

.fow-table td {
    padding: 6px 8px;
    border-bottom: 1px solid #eee;
}

.innings-card {
    background: #f8f9fa;
    border-radius: 8px;
    margin-bottom: 15px;
    overflow: hidden;
}

.innings-header {
    background: #2d5a3d;
    color: #fff;
    padding: 10px 15px;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
}

.innings-body {
    padding: 10px 15px;
}

.batting-table, .bowling-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
    margin-bottom: 10px;
}

.batting-table th, .bowling-table th {
    text-align: left;
    padding: 8px 5px;
    background: #e9ecef;
    font-weight: 600;
    color: #333;
}

.batting-table td, .bowling-table td {
    padding: 8px 5px;
    border-bottom: 1px solid #eee;
}

.batting-table .player-name, .bowling-table .player-name {
    font-weight: 500;
    color: #1a472a;
}

.batting-table .runs, .bowling-table .wickets {
    font-weight: 700;
    color: #222;
}

.batting-table .dismissal {
    font-size: 0.75rem;
    color: #666;
}

.extras-row, .total-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    font-size: 0.85rem;
}

.total-row {
    font-weight: 700;
    border-top: 2px solid #ddd;
    margin-top: 5px;
    padding-top: 10px;
}

.section-title {
    font-weight: 600;
    color: #1a472a;
    margin: 15px 0 8px 0;
    font-size: 0.9rem;
}

.scorecard-loading {
    text-align: center;
    padding: 40px;
    color: #666;
}

.scorecard-loading i {
    font-size: 2rem;
    margin-bottom: 10px;
    color: #1a472a;
}

@media (max-width: 576px) {
    .batting-table, .bowling-table {
        font-size: 0.75rem;
    }
    
    .batting-table th, .batting-table td,
    .bowling-table th, .bowling-table td {
        padding: 6px 3px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const sliders = document.querySelectorAll('.matches-slider');
    
    sliders.forEach(slider => {
        let isDown = false;
        let startX;
        let scrollLeft;
        let isDragging = false;
        
        slider.addEventListener('mousedown', (e) => {
            isDown = true;
            isDragging = false;
            slider.style.cursor = 'grabbing';
            startX = e.pageX - slider.offsetLeft;
            scrollLeft = slider.scrollLeft;
        });
        
        slider.addEventListener('mouseleave', () => {
            isDown = false;
            slider.style.cursor = 'grab';
        });
        
        slider.addEventListener('mouseup', () => {
            isDown = false;
            slider.style.cursor = 'grab';
        });
        
        slider.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            isDragging = true;
            const x = e.pageX - slider.offsetLeft;
            const walk = (x - startX) * 2;
            slider.scrollLeft = scrollLeft - walk;
        });
        
        slider.addEventListener('click', (e) => {
            if (isDragging) {
                e.stopPropagation();
                e.preventDefault();
            }
        }, true);
    });
});

async function loadScorecard(matchId) {
    const newsContent = document.getElementById('news-content');
    const scorecardContent = document.getElementById('scorecard-content');
    
    document.querySelectorAll('.match-card').forEach(card => {
        card.classList.remove('active');
        if (card.dataset.matchId === matchId) {
            card.classList.add('active');
        }
    });
    
    newsContent.style.display = 'none';
    scorecardContent.style.display = 'block';
    scorecardContent.innerHTML = `
        <div class="scorecard-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading scorecard...</p>
        </div>
    `;
    
    document.getElementById('content-box').scrollIntoView({ behavior: 'smooth', block: 'start' });
    
    try {
        const response = await fetch('/api/scrape/scorecard', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ match_id: matchId })
        });
        
        const data = await response.json();
        
        if (data.success) {
            displayScorecard(data.scorecard);
        } else {
            scorecardContent.innerHTML = `
                <div class="scorecard-header">
                    <h3>Scorecard</h3>
                    <button class="back-to-news" onclick="showNews()">← Back to News</button>
                </div>
                <div class="scorecard-loading">
                    <p>Unable to load scorecard. Please try again.</p>
                </div>
            `;
        }
    } catch (err) {
        scorecardContent.innerHTML = `
            <div class="scorecard-header">
                <h3>Scorecard</h3>
                <button class="back-to-news" onclick="showNews()">← Back to News</button>
            </div>
            <div class="scorecard-loading">
                <p>Error loading scorecard.</p>
            </div>
        `;
    }
}

function displayScorecard(scorecard) {
    const scorecardContent = document.getElementById('scorecard-content');
    
    // Determine status badge class and text
    let statusClass = 'upcoming';
    let statusText = scorecard.state || 'MATCH';
    if (scorecard.state === 'Live' || scorecard.state === 'In Progress') {
        statusClass = 'live';
    } else if (scorecard.state === 'Innings Break') {
        statusClass = 'innings';
    } else if (['Stumps', 'Lunch', 'Tea', 'Drinks'].includes(scorecard.state)) {
        statusClass = 'break';
    } else if (scorecard.state === 'Complete') {
        statusClass = 'complete';
    } else if (scorecard.state === 'Preview') {
        statusClass = 'preview';
    } else if (scorecard.state === 'Abandon') {
        statusClass = 'abandon';
    }
    
    // Get team names from correct fields
    const team1 = scorecard.team1 || scorecard.team1_name || 'Team 1';
    const team2 = scorecard.team2 || scorecard.team2_name || 'Team 2';
    
    let html = `
        <div class="scorecard-header">
            <h3>Live Scorecard</h3>
            <span class="status-badge ${statusClass}">${statusText.toUpperCase()}</span>
            <button class="back-to-news" onclick="showNews()">← Back to News</button>
        </div>
        <div class="scorecard-match-info">
            <div class="match-title">${team1} vs ${team2}</div>
            ${scorecard.match_short ? `<div class="match-format">${scorecard.match_short}</div>` : ''}
            <div class="match-venue">${scorecard.venue || ''}</div>
            ${scorecard.match_datetime ? `<div class="match-datetime">${scorecard.match_datetime}</div>` : ''}
            ${scorecard.toss ? `<div class="match-toss">${scorecard.toss}</div>` : ''}
            ${scorecard.live_status ? `<div class="match-live-status">${scorecard.live_status}</div>` : ''}
            ${scorecard.result ? `<div class="match-result-text">${scorecard.result}</div>` : ''}
        </div>
    `;
    
    if (scorecard.innings && scorecard.innings.length > 0) {
        scorecard.innings.forEach((inning, idx) => {
            html += `
                <div class="innings-card">
                    <div class="innings-header">
                        <span>${inning.team_name || 'Team'} - Innings ${idx + 1}</span>
                        <span>${inning.total_score || '0'}/${inning.wickets || '0'} (${inning.overs || '0'} Ov)</span>
                    </div>
                    <div class="innings-body">
            `;
            
            if (inning.batting && inning.batting.length > 0) {
                html += `
                    <div class="section-title">Batting</div>
                    <table class="batting-table">
                        <thead>
                            <tr>
                                <th>Batter</th>
                                <th>R</th>
                                <th>B</th>
                                <th>4s</th>
                                <th>6s</th>
                                <th>SR</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                inning.batting.forEach(batter => {
                    html += `
                        <tr>
                            <td>
                                <span class="player-name">${batter.player || batter.name || ''}</span>
                                <div class="dismissal">${batter.dismissal || ''}</div>
                            </td>
                            <td class="runs">${batter.runs || '0'}</td>
                            <td>${batter.balls || '0'}</td>
                            <td>${batter.fours || '0'}</td>
                            <td>${batter.sixes || '0'}</td>
                            <td>${batter.strike_rate || '0'}</td>
                        </tr>
                    `;
                });
                html += `</tbody></table>`;
            }
            
            if (inning.extras) {
                html += `<div class="extras-row"><span>Extras</span><span>${inning.extras}</span></div>`;
            }
            html += `<div class="total-row"><span>Total</span><span>${inning.total_score || '0'}/${inning.wickets || '0'} (${inning.overs || '0'} Ov)</span></div>`;
            
            if (inning.bowling && inning.bowling.length > 0) {
                html += `
                    <div class="section-title">Bowling</div>
                    <table class="bowling-table">
                        <thead>
                            <tr>
                                <th>Bowler</th>
                                <th>O</th>
                                <th>M</th>
                                <th>R</th>
                                <th>W</th>
                                <th>Eco</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                inning.bowling.forEach(bowler => {
                    html += `
                        <tr>
                            <td class="player-name">${bowler.bowler || bowler.name || ''}</td>
                            <td>${bowler.overs || '0'}</td>
                            <td>${bowler.maidens || '0'}</td>
                            <td>${bowler.runs || '0'}</td>
                            <td class="wickets">${bowler.wickets || '0'}</td>
                            <td>${bowler.economy || '0'}</td>
                        </tr>
                    `;
                });
                html += `</tbody></table>`;
            }
            
            // Fall of Wickets
            if (inning.fall_of_wickets && inning.fall_of_wickets.length > 0) {
                html += `
                    <div class="section-title">Fall of Wickets</div>
                    <table class="fow-table">
                        <thead>
                            <tr>
                                <th>Player</th>
                                <th>Score</th>
                                <th>Over</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                inning.fall_of_wickets.forEach(fow => {
                    html += `
                        <tr>
                            <td>${fow.player || ''}</td>
                            <td>${fow.score || ''}</td>
                            <td>${fow.over || ''}</td>
                        </tr>
                    `;
                });
                html += `</tbody></table>`;
            }
            
            html += `</div></div>`;
        });
    } else {
        html += `<div class="scorecard-loading"><p>No innings data available yet.</p></div>`;
    }
    
    scorecardContent.innerHTML = html;
}

function showNews() {
    const newsContent = document.getElementById('news-content');
    const scorecardContent = document.getElementById('scorecard-content');
    
    newsContent.style.display = 'block';
    scorecardContent.style.display = 'none';
    
    document.querySelectorAll('.match-card').forEach(card => {
        card.classList.remove('active');
    });
}
</script>
{% endblock %}
