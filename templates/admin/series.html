{% extends 'admin/base.html' %}

{% block title %}Series - Admin Panel{% endblock %}
{% block page_title %}Series{% endblock %}

{% block content %}
<div class="admin-page">
    <div class="scrape-tab">
        <div class="url-input-group">
            <input type="text" id="series-url" class="url-input" 
                   value="https://www.cricbuzz.com/cricket-schedule/series/international" 
                   placeholder="Enter Cricbuzz series URL">
            <button class="btn-scrape" onclick="scrapeSeriesFromUrl()">
                <i class="fas fa-download"></i> Scrape
            </button>
        </div>
    </div>
    
    <div class="data-preview" id="data-preview">
        <div class="preview-header">
            <h3>JSON Data Preview</h3>
            <span class="badge" id="series-count">0 series</span>
        </div>
        <div class="preview-content" id="preview-content">
            <p class="hint-text">Click "Scrape" to fetch series data from URL</p>
        </div>
    </div>
</div>

<style>
.scrape-tab {
    background: #1f2937;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 15px;
    border: 1px solid #374151;
}

.url-input-group {
    display: flex;
    gap: 10px;
    align-items: center;
}

.url-input {
    flex: 1;
    padding: 8px 12px;
    background: #111827;
    border: 1px solid #374151;
    border-radius: 4px;
    color: #e4e4e7;
    font-size: 12px;
    font-family: monospace;
}

.url-input:focus {
    outline: none;
    border-color: #10b981;
}

.btn-scrape {
    background: #10b981;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
}

.btn-scrape:hover {
    background: #059669;
}

.btn-scrape:disabled {
    background: #374151;
    cursor: not-allowed;
}

.data-preview {
    background: #1f2937;
    border-radius: 6px;
    border: 1px solid #374151;
    overflow: hidden;
}

.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background: #111827;
    border-bottom: 1px solid #374151;
}

.preview-header h3 {
    margin: 0;
    font-size: 13px;
    color: #e4e4e7;
}

.badge {
    background: #10b981;
    color: white;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: 600;
}

.preview-content {
    padding: 15px;
    max-height: 500px;
    overflow-y: auto;
}

.hint-text {
    color: #9ca3af;
    font-size: 12px;
    text-align: center;
    margin: 20px 0;
}

.series-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
}

.series-table th {
    background: #111827;
    color: #e4e4e7;
    padding: 8px 10px;
    text-align: left;
    font-weight: 600;
    font-size: 10px;
    text-transform: uppercase;
    position: sticky;
    top: 0;
}

.series-table td {
    padding: 6px 10px;
    border-bottom: 1px solid #374151;
    color: #e4e4e7;
}

.series-table tbody tr:hover {
    background: #374151;
}

.series-table .id-col {
    color: #10b981;
    font-family: monospace;
    font-size: 10px;
    width: 80px;
}

.series-table .name-col {
    font-weight: 500;
}

.loading {
    text-align: center;
    padding: 30px;
    color: #9ca3af;
}

.loading i {
    font-size: 24px;
    margin-bottom: 10px;
    display: block;
    color: #10b981;
}
</style>

<script>
async function scrapeSeriesFromUrl() {
    const urlInput = document.getElementById('series-url');
    const btn = document.querySelector('.btn-scrape');
    const previewContent = document.getElementById('preview-content');
    const countBadge = document.getElementById('series-count');
    
    const url = urlInput.value.trim();
    if (!url) {
        alert('Please enter a URL');
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scraping...';
    previewContent.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i>Fetching data from Cricbuzz...</div>';
    
    try {
        const response = await fetch('/api/scrape/series-json', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url: url })
        });
        
        const data = await response.json();
        
        if (data.success && data.series && data.series.length > 0) {
            countBadge.textContent = data.series.length + ' series';
            
            let html = '<table class="series-table"><thead><tr>';
            html += '<th>Series ID</th>';
            html += '<th>Series Name</th>';
            html += '</tr></thead><tbody>';
            
            data.series.forEach(s => {
                html += `<tr>
                    <td class="id-col">${s.id}</td>
                    <td class="name-col">${s.name}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            previewContent.innerHTML = html;
        } else {
            previewContent.innerHTML = '<p class="hint-text">No series data found</p>';
            countBadge.textContent = '0 series';
        }
    } catch (error) {
        previewContent.innerHTML = '<p class="hint-text">Error: ' + error.message + '</p>';
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-download"></i> Scrape';
    }
}
</script>
{% endblock %}
